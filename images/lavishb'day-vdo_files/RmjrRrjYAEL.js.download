;/*FB_PKG_DELIM*/

__d("WAWebPipMsgVideoTag.react",["WAWebFrontendMsgGetters","WAWebMediaOpaqueData","WAWebMsgGetters","WAWebNewsletterGatingUtils","WAWebPipUrlVideoTagLoadable.react","WAWebPipVideoStreaming","WAWebUserPrefsGeneral","react","useMergeRefs","useWAWebCometVideoPlayerStateMachine","useWAWebModelValues","useWAWebMsgValues","useWAWebOnUnmount","useWAWebStableCallback"],(function(a,b,c,d,e,f,g){var h,i;b=i||d("react");var j=h||(h=c("react")),k=b.useCallback,l=b.useEffect,m=b.useRef;e=j.forwardRef(a);function a(a,b){var e;a=babelHelpers["extends"]({},a);var f=a.onLoadedMetadata,g=d("useWAWebMsgValues").useMsgValues(a.msg.id,[d("WAWebMsgGetters").getId]);g=g[0];var h=d("useWAWebModelValues").useModelValues(a.mediaData,["mediaBlob","streamable","aspectRatio"]),i=m(null),n=c("useMergeRefs")(b,i);b=d("WAWebFrontendMsgGetters").getChat(a.msg).id.toString().replace(/@.*/,"");e=(e=a.msg.serverId)!=null?e:"";b=b+"_"+e;e=a.msg.getWamMessageType();e=c("useWAWebCometVideoPlayerStateMachine")({mediaId:d("WAWebNewsletterGatingUtils").getNewsletterLoggingMediaID(),isCopyrightMuted:!1,videoOrigin:e,mediaIdString:b});b=e.callbacks;var o=e.videoElementRefCallback,p=e.handleReactEffectCleanup,q=e.handleReactEffectInit;e=m(Boolean(h.mediaBlob));l(function(){q()},[q]);c("useWAWebOnUnmount")(function(){p()});var r=c("useWAWebStableCallback")(function(a){if(i.current===a)return;var b=a==null?void 0:a.underlyingVideo();b!=null&&o(b);n(a);if(a){b=d("WAWebUserPrefsGeneral").getMediaVolumeSettings();var c=b.volume;b=b.muted;c!=null&&a.setVolume(c);a.setMuted(b)}}),s=k(function(a,b){var c=h.aspectRatio,d=a.videoWidth!==0&&a.videoHeight!==0?a.videoWidth/a.videoHeight:void 0;(!c&&d!=null&&d!==0||c&&d!=null&&d!==0&&Math.abs(d-c)>.01)&&h.set({aspectRatio:d});f(a,b)},[h,f]),t=h.mediaBlob,u=h.streamable&&h.isStreamable();(e.current||!u)&&t instanceof c("WAWebMediaOpaqueData")?e=t.url():h.streamable&&h.isStreamable()?e=d("WAWebPipVideoStreaming").VIDEO_STREAM_URL+"?key="+g.toString():e=void 0;return j.jsx(d("WAWebPipUrlVideoTagLoadable.react").UrlVideoTagLoadable,{ref:r,url:e,startTime:a.startTime,poster:a.poster,className:a.className,onVolumeChange:a.onVolumeChange,onEnded:a.onEnded,onError:a.onError,onPause:a.onPause,onPlaying:a.onPlaying,onProgress:a.onProgress,onTimeUpdate:a.onTimeUpdate,onLoadedMetadata:s,autoPlay:a.autoPlay,onCanPlay:a.onCanPlay,onLoadedData:a.onLoadedData,onWaiting:a.onWaiting,callbacks:b,children:a.children})}a.displayName=a.name+" [from "+f.id+"]";b=e;g["default"]=b}),98);